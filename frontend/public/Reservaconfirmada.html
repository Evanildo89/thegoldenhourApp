<!DOCTYPE html>
<html lang="pt">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reserva Confirmada</title>
  <link rel="stylesheet" href="Reservaconfirmada.css">
</head>
<body>
  <div class="reserva-box-container">
    <div class="logo-top">
      <div class="logo-circle-servicos">
        <img src="./images/3.png" alt="Logo">
      </div>
    </div>

    <div class="reserva-box">
      <div class="mensagem-confirmacao">
        Reserva Confirmada
      </div>

      <div id="profissional-section" style="display:none;">
  <div class="profissional-nome" id="prof-name"></div>
</div>

      <div id="reserva-datetime" class="reserva-datetime">
  <div class="datetime-label">Data e hora</div>
  <div class="datetime-value">
    <span id="reserva-data">--/--/----</span> . <span id="reserva-hora">--:--</span>
  </div>
</div>

      <div class="reserva-servico" id="reserva-servico">
  <span class="prefixo">Serviço </span>
  <span class="nome-servico">--</span>
       <div class="reserva-detalhes">
    <div class="detalhes-info">
      <span class="duracao">-- min</span>
      <span class="profissional-info"> com --</span>
    </div>
    <span class="preco-servico">€--</span>
  </div>

  <div class="reserva-total">
    <span class="total-texto">Total a pagar</span>
    <span class="total-valor">€--</span>
  </div>

  <div class="reserva-confirmacao-email" id="confirmacao-email" style="display:none;">
  Foi-lhe enviada uma confirmação para o e-mail
</div>

        <div class="outra-marcacao-container">
  <button class="btn-outra-marcacao" onclick="fazerOutraMarcacao()">Fazer outra marcação</button>
</div>
</div>
    </div>
  </div>

  <script>
const API_BASE_URL = "http://localhost:8000";

// Função auxiliar para obter parâmetros da URL
function getQueryParam(param) {
    const params = new URLSearchParams(window.location.search);
    return params.get(param) ? decodeURIComponent(params.get(param)) : null;
}

// --- Profissional ---
const profParam = getQueryParam("prof");
let professional = {};
if (profParam) {
    try {
        professional = JSON.parse(profParam);
        if (professional && professional.name) {
            const profSection = document.getElementById("profissional-section");
            if (profSection) profSection.style.display = "block";

            const profNameElem = document.getElementById("prof-name");
            if (profNameElem) profNameElem.textContent = `Com ${professional.name}`;
        }
    } catch (e) {
        console.error("Erro ao processar dados do profissional:", e);
    }
}

// --- Data e hora ---
const dataParam = getQueryParam("data");
const horaParam = getQueryParam("hora");

if (dataParam) {
    const [ano, mes, dia] = dataParam.split("-");

    const diasSemana = ["Dom", "Seg", "Ter", "Qua", "Qui", "Sex", "Sáb"];
    const meses = ["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"];

    const dateObj = new Date(`${ano}-${mes}-${dia}`);
    const diaSemana = diasSemana[dateObj.getDay()];

    const dataElem = document.getElementById("reserva-data");
    if (dataElem) dataElem.textContent = `${diaSemana}. ${dia} ${meses[parseInt(mes)-1]} ${ano}`;
}

if (horaParam) {
    const horaElem = document.getElementById("reserva-hora");
    if (horaElem) horaElem.textContent = horaParam;
}

// --- Pacote/Serviço ---
const pacoteParam = getQueryParam("pacote");
if (pacoteParam) {
    const spanServico = document.querySelector("#reserva-servico .nome-servico");
    if (spanServico) spanServico.textContent = pacoteParam;
}

// --- Duração ---
const duracaoParam = getQueryParam("duracao") || "30 min";
const spanDuracao = document.querySelector(".reserva-detalhes .duracao");
if(spanDuracao) spanDuracao.textContent = duracaoParam;

// --- Profissional info detalhada ---
if (professional && professional.name) {
    const bio = professional.bio ? ` - ${professional.bio}` : "";
    const spanProf = document.querySelector(".reserva-detalhes .profissional-info");
    if(spanProf) spanProf.textContent = ` com ${professional.name}${bio}`;
}

// --- Preço e total ---
const valorParam = getQueryParam("valor") || "0";
const spanPreco = document.querySelector(".reserva-detalhes .preco-servico");
if(spanPreco) spanPreco.textContent = `€${valorParam}`;

const spanTotal = document.querySelector(".reserva-total .total-valor");
if(spanTotal) spanTotal.textContent = `€${valorParam}`;

// --- Mensagem de confirmação por email ---
const lembrete = localStorage.getItem('lembrete') === 'true';
const confirmacaoEmail = document.getElementById('confirmacao-email');
if (confirmacaoEmail) {
    confirmacaoEmail.style.display = lembrete ? 'block' : 'none';
}

// --- Função para fazer outra marcação ---
function fazerOutraMarcacao() {
    window.location.href = `${window.location.origin}/pagina-marcacao.html`;
}
</script>
</body>
</html>